"
I am verification for RelationSource rule. 

Overriden methods: verifiedClass, verifyObject:withModel:

New methods: validSources.
"
Class {
	#name : 'RelationSourceVerification',
	#superclass : 'RelationEndVerification',
	#traits : 'TCodeInjectionChecker + TClassUpdater',
	#classTraits : 'TCodeInjectionChecker classTrait + TClassUpdater classTrait',
	#category : 'OpenPonk-OntoUML-Verifications-Verification-Classes',
	#package : 'OpenPonk-OntoUML-Verifications',
	#tag : 'Verification-Classes'
}

{ #category : 'constants' }
RelationSourceVerification class >> abbreviation [
	^ 'RelationSource'.
]

{ #category : 'updating' }
RelationSourceVerification class >> getUpdatedMessageCode: aVerificationUpdater [
	| validSourcesCode |
	validSourcesCode := 'validSources
	"I return dictionary containing collections of allowed sources for each OntoUML relationship stereotype.
	Code generated by getUpdatedMessageCode."

	| result |
	result := Dictionary new.'.
	aVerificationUpdater relationshipSpecifications
		do: [ :relationshipSpecification | self checkStringForCodeInjection: relationshipSpecification name.
			validSourcesCode := validSourcesCode , (String with: Character cr)
				, '	result add: self validSourcesFor'
				, relationshipSpecification name , '.' ].
	validSourcesCode := validSourcesCode , (String with: Character cr)
		, '	^ result.'.
	^ validSourcesCode.
]

{ #category : 'updating' }
RelationSourceVerification class >> getValidSourcesFor: aRelationship fromCollection: aCollection [

	| methodTemplate |
	self checkStringForCodeInjection: aRelationship.
	methodTemplate := 'validSourcesFor' , aRelationship , String cr
	                  ,
	                  '	"I return association between OntoUML relationship stereotype '
	                  , aRelationship , ' and its allowed sources.
	I am generated by getValidSourcesFor:FromCollection: and tested by testGetValidSourcesForFromCollection."'
	                  , String cr , String cr , '	^ OntoUML'
	                  , aRelationship , ' -> { '.
	aCollection do: [ :item |
		self checkStringForCodeInjection: item.
		methodTemplate := methodTemplate , 'OntoUML' , item , '. ' ].
	methodTemplate := methodTemplate , '}.'.
	^ methodTemplate
]

{ #category : 'updating' }
RelationSourceVerification class >> setValidSourcesFor: aStereotype fromCollection: aCollection [
	| validSourcesForCode |
	validSourcesForCode := self getValidSourcesFor: aStereotype fromCollection: aCollection.
	self updateMessage: validSourcesForCode withClassification: 'constants'.
]

{ #category : 'updating' }
RelationSourceVerification class >> updateFrom: aVerificationUpdater [
	| updatedMessageCode |
	updatedMessageCode := self getUpdatedMessageCode: aVerificationUpdater.
	aVerificationUpdater relationshipSpecifications do: [ :relationshipSpecification |
		self setValidSourcesFor: relationshipSpecification name fromCollection: 
		(self expandAllowedClassStereotypesIn: (relationshipSpecification allowedSources) from: aVerificationUpdater). ]. 	
	self updateMessage: updatedMessageCode  withClassification: 'constants'.
	
]

{ #category : 'constants' }
RelationSourceVerification class >> validSources [
	"I return dictionary containing collections of allowed sources for each OntoUML relationship stereotype.
	Code generated by getUpdatedMessageCode."

	| result |
	result := Dictionary new.
	result add: self validSourcesForComponentOf.
	result add: self validSourcesForContainment.
	result add: self validSourcesForMemberOf.
	result add: self validSourcesForSubCollectionOf.
	result add: self validSourcesForSubQuantityOf.
	result add: self validSourcesForCharacterization.
	result add: self validSourcesForDerivation.
	result add: self validSourcesForDomainFormal.
	result add: self validSourcesForMaterial.
	result add: self validSourcesForMediation.
	^ result.
]

{ #category : 'constants' }
RelationSourceVerification class >> validSourcesForCharacterization [
	"I return association between OntoUML relationship stereotype Characterization and its allowed sources.
	I am generated by getValidSourcesFor:FromCollection: and tested by testGetValidSourcesForFromCollection."

	^ OntoUMLCharacterization -> { OntoUMLKind. OntoUMLSubKind. OntoUMLCollective. OntoUMLPhase. OntoUMLQuantity. OntoUMLRelator. OntoUMLRole. OntoUMLMode. OntoUMLQuality. OntoUMLCategory. OntoUMLMixin. OntoUMLRoleMixin. OntoUMLPhaseMixin. }.
]

{ #category : 'constants' }
RelationSourceVerification class >> validSourcesForComponentOf [
	"I return association between OntoUML relationship stereotype ComponentOf and its allowed sources.
	I am generated by getValidSourcesFor:FromCollection: and tested by testGetValidSourcesForFromCollection."

	^ OntoUMLComponentOf -> { OntoUMLKind. OntoUMLSubKind. OntoUMLCollective. OntoUMLPhase. OntoUMLQuantity. OntoUMLRelator. OntoUMLRole. OntoUMLMode. OntoUMLQuality. OntoUMLCategory. OntoUMLMixin. OntoUMLRoleMixin. OntoUMLPhaseMixin. }.
]

{ #category : 'constants' }
RelationSourceVerification class >> validSourcesForContainment [
	"I return association between OntoUML relationship stereotype Containment and its allowed sources.
	I am generated by getValidSourcesFor:FromCollection: and tested by testGetValidSourcesForFromCollection."

	^ OntoUMLContainment -> { OntoUMLKind. OntoUMLSubKind. OntoUMLCollective. OntoUMLPhase. OntoUMLQuantity. OntoUMLRelator. OntoUMLRole. OntoUMLMode. OntoUMLQuality. OntoUMLCategory. OntoUMLMixin. OntoUMLRoleMixin. OntoUMLPhaseMixin. }.
]

{ #category : 'constants' }
RelationSourceVerification class >> validSourcesForDerivation [
	"I return association between OntoUML relationship stereotype Derivation and its allowed sources.
	I am generated by getValidSourcesFor:FromCollection: and tested by testGetValidSourcesForFromCollection."

	^ OntoUMLDerivation -> { OntoUMLRelator. }.
]

{ #category : 'constants' }
RelationSourceVerification class >> validSourcesForDomainFormal [
	"I return association between OntoUML relationship stereotype DomainFormal and its allowed sources.
	I am generated by getValidSourcesFor:FromCollection: and tested by testGetValidSourcesForFromCollection."

	^ OntoUMLDomainFormal -> { OntoUMLKind. OntoUMLSubKind. OntoUMLCollective. OntoUMLPhase. OntoUMLQuantity. OntoUMLRelator. OntoUMLRole. OntoUMLMode. OntoUMLQuality. OntoUMLCategory. OntoUMLMixin. OntoUMLRoleMixin. OntoUMLPhaseMixin. }.
]

{ #category : 'constants' }
RelationSourceVerification class >> validSourcesForFormal [
	^ OntoUMLFormal -> { OntoUMLKind. OntoUMLSubKind. OntoUMLCollective. OntoUMLPhase. OntoUMLQuantity. OntoUMLRelator. OntoUMLRole. OntoUMLMode. OntoUMLQuality. OntoUMLCategory. OntoUMLMixin. OntoUMLRoleMixin. }.
]

{ #category : 'constants' }
RelationSourceVerification class >> validSourcesForMaterial [
	"I return association between OntoUML relationship stereotype Material and its allowed sources.
	I am generated by getValidSourcesFor:FromCollection: and tested by testGetValidSourcesForFromCollection."

	^ OntoUMLMaterial -> { OntoUMLKind. OntoUMLSubKind. OntoUMLCollective. OntoUMLPhase. OntoUMLQuantity. OntoUMLRelator. OntoUMLRole. OntoUMLMode. OntoUMLQuality. OntoUMLCategory. OntoUMLMixin. OntoUMLRoleMixin. OntoUMLPhaseMixin. }.
]

{ #category : 'constants' }
RelationSourceVerification class >> validSourcesForMediation [
	"I return association between OntoUML relationship stereotype Mediation and its allowed sources.
	I am generated by getValidSourcesFor:FromCollection: and tested by testGetValidSourcesForFromCollection."

	^ OntoUMLMediation -> { OntoUMLKind. OntoUMLSubKind. OntoUMLCollective. OntoUMLPhase. OntoUMLQuantity. OntoUMLRelator. OntoUMLRole. OntoUMLMode. OntoUMLQuality. OntoUMLCategory. OntoUMLMixin. OntoUMLRoleMixin. OntoUMLPhaseMixin. }.
]

{ #category : 'constants' }
RelationSourceVerification class >> validSourcesForMemberOf [
	"I return association between OntoUML relationship stereotype MemberOf and its allowed sources.
	I am generated by getValidSourcesFor:FromCollection: and tested by testGetValidSourcesForFromCollection."

	^ OntoUMLMemberOf -> { OntoUMLCollective. }.
]

{ #category : 'constants' }
RelationSourceVerification class >> validSourcesForSubCollectionOf [
	"I return association between OntoUML relationship stereotype SubCollectionOf and its allowed sources.
	I am generated by getValidSourcesFor:FromCollection: and tested by testGetValidSourcesForFromCollection."

	^ OntoUMLSubCollectionOf -> { OntoUMLCollective. }.
]

{ #category : 'constants' }
RelationSourceVerification class >> validSourcesForSubQuantityOf [
	"I return association between OntoUML relationship stereotype SubQuantityOf and its allowed sources.
	I am generated by getValidSourcesFor:FromCollection: and tested by testGetValidSourcesForFromCollection."

	^ OntoUMLSubQuantityOf -> { OntoUMLQuantity. }.
]

{ #category : 'constants' }
RelationSourceVerification class >> verifiedClass [
	^ OPUMLAssociation.
]

{ #category : 'verification' }
RelationSourceVerification >> getErrorMessageFor: aEnd withAssociation: aAssociation [
	| endStereotypeName associationStereotypeName |
	endStereotypeName := (self class getStereotypeClass: aEnd) name.
	associationStereotypeName := (self class getStereotypeClass: aAssociation) name.
	^ VerificationMessageError createFor: aAssociation
			withVerification: self
			withText: endStereotypeName , ' cannot be source of ' , associationStereotypeName , ' association'.
]

{ #category : 'verification' }
RelationSourceVerification >> getVerifiedEnd: aVerifiedAssociation [
	^ (aVerifiedAssociation memberEnds at: 1) type.
]

{ #category : 'verification' }
RelationSourceVerification >> validStereotypesForEnd [
	^ self class validSources.
]
